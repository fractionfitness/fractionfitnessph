name: Closed PR (main/dev - merged/unmerged)

on:
  pull_request:
    branches: [dev, main, merge]
    types: [closed]

env:
  NODE_VERSION: 18.13.0

jobs:
  merge:
    if: github.base_ref == 'merge'
    uses: ./.github/workflows/pscale-vercel-cleanup.yml
    with:
      gh-environment: Preview
    secrets:
      pscale-token-id: ${{ secrets.PLANETSCALE_SERVICE_TOKEN_ID }}
      pscale-token: ${{ secrets.PLANETSCALE_SERVICE_TOKEN }}
      pscale-src-branch-db-url: ${{ secrets.PSCALE_SRC_BRANCH_DATABASE_URL }}
      vercel-token: ${{ secrets.VERCEL_TOKEN }}

  dev:
    if: github.base_ref == 'dev'
    uses: ./.github/workflows/pscale-vercel-cleanup.yml
    with:
      gh-environment: Preview
    secrets:
      pscale-token-id: ${{ secrets.PLANETSCALE_SERVICE_TOKEN_ID }}
      pscale-token: ${{ secrets.PLANETSCALE_SERVICE_TOKEN }}
      pscale-src-branch-db-url: ${{ secrets.PSCALE_SRC_BRANCH_DATABASE_URL }}
      vercel-token: ${{ secrets.VERCEL_TOKEN }}

  main:
    if: github.base_ref == 'main'
    uses: ./.github/workflows/pscale-vercel-cleanup.yml
    with:
      gh-environment: Production
    secrets:
      pscale-token-id: ${{ secrets.PLANETSCALE_SERVICE_TOKEN_ID }}
      pscale-token: ${{ secrets.PLANETSCALE_SERVICE_TOKEN }}
      pscale-src-branch-db-url: ${{ secrets.PSCALE_SRC_BRANCH_DATABASE_URL }}
      vercel-token: ${{ secrets.VERCEL_TOKEN }}
